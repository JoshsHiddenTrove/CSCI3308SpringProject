<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- JavaScript -->
    <!--
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" crossorigin="anonymous"></script>
    <script src="http://code.jquery.com/jquery-3.4.1.js" crossorigin="anonymous"></script>
    -->
    <script src='/resources/js/jquery.js'></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"></script>-->

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../resources/css/HungryHill.css">

    <title>Hungry Hill</title>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="#">
        <img src="../resources/img/hungryhill.png" width="30" height="30" class="d-inline-block align-top" alt="">
        Hungry Hill
      </a>
      <a class="navbar-brand" href="#"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
       <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
         <li class="nav-item active">
          <a class="nav-link" href="/">Home<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/filters">Filters</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/recipes">Liked Recipes</a>
        </li>
      </ul>
      </div>
    </nav>

    <!-- Gallery -->
    <% // Initialize some useful variables
    var num_results = recipes.length;
    var i=0;
    %>

    <%
      var rec_slides_html
      if (num_results>0) {  // We have results; load all as mySlide objects
        rec_slides_html=`
        <div class="slideshow-container">
        `;
        recipes.forEach(function (rec){
          rec_slides_html+=`
          <div class="mySlides" id='recipeResult_`+i+`' value='`+rec.recipe_id+`'>
            <img src="`+ rec.picture+`">
            <div id='dis=txt' class="text">`+rec.name+`</div>
            <p class='directions' style='display: none;'>`+rec.directions+`</p>
          </div>
          `
          i++;
        });


        rec_slides_html+=`
          <a class="arrow dislike" onclick="swipe(0)">&#10094;</a>
          <a class="arrow like" onclick="swipe(1)">&#10095;</a>
          <a class="arrow down" onclick="ToggleRecipe()">&#65088;</a>

          </div>
        `;
      }
      else {
        rec_slides_html=`
        <h1 class='no_results'>No new recipes that match filters</h1>
        <style>
          .no_results {
            text-align: center;
            margin-top: 40px;
          }
        </style>
        `;
      }
    %>
    <%- rec_slides_html%>
    
    

    <div class="container">
      <div id="recipe" class="recipe" style='display: none;'>
        <h2>Ingredients</h2>
          <ul id='recipe_list'>
            <li>3/4 cup milk</li>
            <li>2 tablespoons white vinegar</li>
            <li>1 cup all-purpose flour</li>
            <li>2 tablespoons white sugar</li>
            <li>1 teaspoon baking powder</li>
            <li>1/2 teaspoon baking soda</li>
            <li>1/2 teaspoon salt</li>
            <li>1 egg</li>
            <li>2 tablespoons butter, melted</li>
            <li>cooking spray</li>
          </ul> 
        <!-- No directions given in db
        <h2>Recipe</h2>
        <ol>
          <li>Combine milk with vinegar in a medium bowl and set aside for 5 minutes to "sour".</li>
          <li>Combine flour, sugar, baking powder, baking soda, and salt in a large mixing bowl. Whisk egg and butter into "soured" milk. Pour the flour mixture into the wet ingredients and whisk until lumps are gone.</li>
          <li>Heat a large skillet over medium heat, and coat with cooking spray. Pour 1/4 cupfuls of batter onto the skillet, and cook until bubbles appear on the surface. Flip with a spatula, and cook until browned on the other side.</li>
        </ol>
      -->
      </div>
    </div>

    <div class="icon-bar">
      <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="facebook"><img src="../resources/img/FBicon.png"></a>
      <!--a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="twitter"><img src="Twiticon.png"></a-->
      <a href="https://www.pinterest.com/foodnetwork/" class="pinterest"><img src="../resources/img/Picon.png"></a>
      <!--a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="instagram"><img src="IGicon.png"></a-->
      <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" class="youtube"><img src="../resources/img/YTicon.png"></a>
    </div>

    <br>

    <script>
    var recIndex = 0;

    loadRecipe(recIndex);

    function swipe(code) {
      // code: (0): left, dis-like; (1): right, like

      // Send post request
      var id=$("#recipeResult_"+recIndex).attr('value');


      console.log(id);
      $.post(window.location.origin+'/swipe?id='+id+'&code='+code);

      // Change Display
      document.getElementById("recipeResult_"+recIndex).style.display='none';
      loadRecipe(++recIndex);
    }


    function loadRecipe(n) {
      var slides = document.getElementsByClassName("mySlides");

      if (!(slides.length>0)) {  // Check if empty
        return;
      }

      if (n >= slides.length) {  // Out of recipes loaded on page; check if more exist (limiter on queries sent to page for optimization)
        setTimeout(function () {
        window.location=window.location;
        },100);
        return;
      }
      // Set appropriate frame to visible
      document.getElementById("recipeResult_"+n).style.display='block';

      // Parse through directions and load
      var directions = $("#recipeResult_"+n).children('p.directions').html();
      var direction_html="";
      var sub="";
      console.log(directions.length);

      for (let i=0; i<directions.length; i++) {
        if (directions[i]==',') {
          direction_html+='<li>'+sub+"</li>";
          sub="";
        }
        else {
          sub+=directions[i];
        }
      }
      
      $('#recipe_list').html(direction_html);
    }

    function ToggleRecipe() {
      document.getElementById("recipe").style.display = (document.getElementById("recipe").style.display==='none' ? 'block' : 'none')
    }

    </script>
  </body>
</html>
